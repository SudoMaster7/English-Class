<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placement Test - English Games Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .question-card {
            background: var(--bg-glass);
            padding: 2.5rem;
            border-radius: var(--border-radius-lg);
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .option {
            padding: 1.25rem;
            background: var(--bg-glass);
            border-radius: var(--border-radius-md);
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all var(--transition-base);
            border: 2px solid transparent;
        }

        .option:hover {
            transform: translateX(8px);
            border-color: var(--color-primary);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
        }

        .option.selected {
            border-color: var(--color-primary);
            background: var(--gradient-primary);
            color: white;
        }

        .progress-bar-container {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.5s ease;
        }

        .level-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            margin: 0.25rem;
        }
    </style>
</head>

<body>
    <div class="animated-bg">
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
    </div>

    <nav class="nav-container">
        <div class="nav-content">
            <a href="index.html" class="nav-logo">üéÆ Back to Hub</a>
            <button class="theme-toggle" onclick="toggleTheme()">
                <div class="theme-toggle-slider">üåô</div>
            </button>
        </div>
    </nav>

    <div class="container">
        <section class="section" style="padding-top: 3rem;">

            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="glass-card"
                style="padding: 3rem; max-width: 800px; margin: 0 auto; text-align: center;">
                <div style="font-size: 5rem; margin-bottom: 1rem;">üìù</div>
                <h1
                    style="font-size: 2.5rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem;">
                    English Placement Test
                </h1>
                <p style="font-size: 1.25rem; color: var(--text-secondary); margin-bottom: 2rem; line-height: 1.6;">
                    Descubra seu n√≠vel de ingl√™s! Este teste tem <strong>20 quest√µes</strong> que v√£o do b√°sico ao
                    avan√ßado.
                    Ele avaliar√° seu vocabul√°rio, gram√°tica e compreens√£o.
                </p>

                <div
                    style="background: rgba(16,185,129,0.1); padding: 1.5rem; border-radius: var(--border-radius-md); margin-bottom: 2rem; text-align: left;">
                    <h3 style="color: var(--text-primary); margin-bottom: 1rem;">‚ÑπÔ∏è Como Funciona:</h3>
                    <ul style="color: var(--text-secondary); line-height: 1.8;">
                        <li>20 quest√µes de m√∫ltipla escolha</li>
                        <li>Perguntas progressivamente mais dif√≠ceis</li>
                        <li>Avalia todos os n√≠veis CEFR (A1 at√© C2)</li>
                        <li>Leva aproximadamente 10-15 minutos</li>
                        <li>Resultado imediato com recomenda√ß√µes personalizadas</li>
                    </ul>
                </div>

                <button onclick="startTest()" class="btn btn-primary"
                    style="font-size: 1.25rem; padding: 1rem 3rem; min-width: 250px;">
                    Come√ßar Teste ‚Üí
                </button>
            </div>

            <!-- Test Screen -->
            <div id="testScreen" class="hidden">
                <div class="glass-card" style="padding: 2rem; max-width: 900px; margin: 0 auto;">

                    <!-- Progress -->
                    <div style="margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-weight: 600;">
                                Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                            </span>
                            <span style="color: var(--text-secondary); font-weight: 600;">
                                Time: <span id="timer">00:00</span>
                            </span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progressBar" style="width: 5%;"></div>
                        </div>
                    </div>

                    <!-- Question -->
                    <div class="question-card">
                        <h2 id="questionText"
                            style="font-size: 1.5rem; color: var(--text-primary); margin-bottom: 2rem;">
                            Loading question...
                        </h2>

                        <div id="optionsContainer">
                            <!-- Options will be inserted here -->
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div style="display: flex; justify-content: space-between; gap: 1rem;">
                        <button id="prevBtn" onclick="previousQuestion()" class="btn" style="min-width: 150px;"
                            disabled>
                            ‚Üê Anterior
                        </button>
                        <button id="nextBtn" onclick="nextQuestion()" class="btn btn-primary" style="min-width: 150px;"
                            disabled>
                            Pr√≥xima ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- Result Screen -->
            <div id="resultScreen" class="hidden">
                <div class="glass-card" style="padding: 3rem; max-width: 800px; margin: 0 auto; text-align: center;">
                    <div style="font-size: 5rem; margin-bottom: 1rem;">üéâ</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 1rem; color: var(--text-primary);">
                        Teste Conclu√≠do!
                    </h2>

                    <!-- Result Details -->
                    <div
                        style="background: var(--gradient-primary); color: white; padding: 2rem; border-radius: var(--border-radius-lg); margin: 2rem 0;">
                        <p style="font-size: 1rem; margin-bottom: 0.5rem; opacity: 0.9;">Seu N√≠vel:</p>
                        <h1 id="resultLevel" style="font-size: 4rem; margin: 0; font-weight: 800;">A1</h1>
                        <p id="resultLevelName" style="font-size: 1.5rem; margin-top: 0.5rem; opacity: 0.95;">Beginner
                        </p>
                    </div>

                    <!-- Score Details -->
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        <div class="glass-card" style="padding: 1.5rem;">
                            <div style="font-size: 2.5rem; font-weight: 800; color: var(--color-success);"
                                id="scoreDisplay">0</div>
                            <div style="color: var(--text-secondary);">Acertos</div>
                        </div>
                        <div class="glass-card" style="padding: 1.5rem;">
                            <div style="font-size: 2.5rem; font-weight: 800; color: var(--color-primary);"
                                id="percentageDisplay">0%</div>
                            <div style="color: var(--text-secondary);">Precis√£o</div>
                        </div>
                        <div class="glass-card" style="padding: 1.5rem;">
                            <div style="font-size: 2.5rem; font-weight: 800; color: var(--color-info);"
                                id="timeDisplay">0:00</div>
                            <div style="color: var(--text-secondary);">Tempo Total</div>
                        </div>
                    </div>

                    <!-- Recommendation -->
                    <div class="glass-card" style="padding: 2rem; text-align: left; margin-bottom: 2rem;">
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem;">üìö Recomenda√ß√£o:</h3>
                        <p id="recommendation"
                            style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem;">
                            Loading recommendation...
                        </p>
                        <div id="suggestedThemes" style="margin-top: 1rem;">
                            <!-- Suggested themes will be inserted here -->
                        </div>
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button onclick="saveAndContinue()" class="btn btn-success" style="min-width: 200px;">
                            Salvar Resultado ‚Üí
                        </button>
                        <button onclick="retakeTest()" class="btn" style="min-width: 200px;">
                            üîÑ Refazer Teste
                        </button>
                        <button onclick="window.location.href='index.html'" class="btn" style="min-width: 200px;">
                            üè† Voltar ao Hub
                        </button>
                    </div>
                </div>
            </div>

        </section>
    </div>

    <script src="js/storage.js"></script>
    <script src="js/lessons.js"></script>
    <script>
        // Placement Test Questions (20 questions, progressive difficulty)
        const questions = [
            // A1 Level (Questions 1-4)
            { level: 'A1', question: 'Hello! My name ___ John.', options: ['is', 'am', 'are', 'be'], correct: 0 },
            { level: 'A1', question: 'I ___ a student.', options: ['is', 'am', 'are', 'be'], correct: 1 },
            { level: 'A1', question: 'What is this? It\'s ___ apple.', options: ['a', 'an', 'the', '-'], correct: 1 },
            { level: 'A1', question: 'She ___ at home every day.', options: ['go', 'goes', 'going', 'to go'], correct: 1 },

            // A2 Level (Questions 5-8)
            { level: 'A2', question: 'I ___ to the cinema yesterday.', options: ['go', 'goes', 'went', 'going'], correct: 2 },
            { level: 'A2', question: 'There are ___ books on the table.', options: ['much', 'many', 'a lot', 'any'], correct: 1 },
            { level: 'A2', question: 'She is ___ than her sister.', options: ['tall', 'taller', 'tallest', 'more tall'], correct: 1 },
            { level: 'A2', question: 'I ___ English for two years.', options: ['study', 'am studying', 'have studied', 'studied'], correct: 2 },

            // B1 Level (Questions 9-12)
            { level: 'B1', question: 'If I ___ rich, I would travel the world.', options: ['am', 'was', 'were', 'be'], correct: 2 },
            { level: 'B1', question: 'The project ___ by next Friday.', options: ['will finish', 'finishes', 'must be finished', 'finishing'], correct: 2 },
            { level: 'B1', question: 'I wish I ___ speak French fluently.', options: ['can', 'could', 'will', 'would'], correct: 1 },
            { level: 'B1', question: 'He suggested ___ to the museum.', options: ['to go', 'going', 'go', 'goes'], correct: 1 },

            // B2 Level (Questions 13-16)
            { level: 'B2', question: 'By this time next year, I ___ my degree.', options: ['complete', 'will complete', 'will have completed', 'am completing'], correct: 2 },
            { level: 'B2', question: 'The more you practice, ___ you become.', options: ['better', 'the better', 'best', 'the best'], correct: 1 },
            { level: 'B2', question: 'I would rather you ___ me the truth.', options: ['tell', 'told', 'telling', 'to tell'], correct: 1 },
            { level: 'B2', question: '___ the weather, we decided to go hiking.', options: ['Despite', 'Although', 'Even', 'However'], correct: 0 },

            // C1 Level (Questions 17-18)
            { level: 'C1', question: 'Had I known about the traffic, I ___ earlier.', options: ['would leave', 'would have left', 'will leave', 'left'], correct: 1 },
            { level: 'C1', question: 'The proposal was rejected on the ___ that it was too expensive.', options: ['basis', 'grounds', 'reasons', 'foundation'], correct: 1 },

            // C2 Level (Questions 19-20)
            { level: 'C2', question: 'Her speech was so ___ that everyone was moved to tears.', options: ['poignant', 'pointed', 'punctual', 'prominent'], correct: 0 },
            { level: 'C2', question: '___ the circumstances, I believe we made the right decision.', options: ['Giving', 'Given', 'Give', 'Gives'], correct: 1 }
        ];

        let currentQuestionIndex = 0;
        let answers = [];
        let startTime;
        let timerInterval;

        // Initialize
        ThemeManager.init();
        SoundFX.init();

        function toggleTheme() {
            const newTheme = ThemeManager.toggle();
            document.querySelector('.theme-toggle-slider').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            SoundFX.play('click');
        }

        // Start test
        function startTest() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('testScreen').classList.remove('hidden');

            currentQuestionIndex = 0;
            answers = new Array(questions.length).fill(null);
            startTime = Date.now();

            startTimer();
            loadQuestion();
            SoundFX.play('success');
        }

        // Timer
        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent =
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Load question
        function loadQuestion() {
            const question = questions[currentQuestionIndex];

            document.getElementById('questionText').textContent =
                `${currentQuestionIndex + 1}. ${question.question}`;
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('totalQuestions').textContent = questions.length;

            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            // Load options
            const container = document.getElementById('optionsContainer');
            container.innerHTML = question.options.map((option, index) => `
                <div class="option ${answers[currentQuestionIndex] === index ? 'selected' : ''}" 
                     onclick="selectOption(${index})">
                    <strong>${String.fromCharCode(65 + index)}.</strong> ${option}
                </div>
            `).join('');

            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').disabled = answers[currentQuestionIndex] === null;
            document.getElementById('nextBtn').textContent =
                currentQuestionIndex === questions.length - 1 ? 'Finalizar ‚Üí' : 'Pr√≥xima ‚Üí';
        }

        // Select option
        function selectOption(index) {
            answers[currentQuestionIndex] = index;
            loadQuestion();
            document.getElementById('nextBtn').disabled = false;
            SoundFX.play('click');
        }

        // Navigation
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
                SoundFX.play('click');
            } else {
                finishTest();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
                SoundFX.play('click');
            }
        }

        // Finish test
        function finishTest() {
            clearInterval(timerInterval);

            // Calculate score
            let correctAnswers = 0;
            questions.forEach((question, index) => {
                if (answers[index] === question.correct) {
                    correctAnswers++;
                }
            });

            const percentage = Math.round((correctAnswers / questions.length) * 100);
            const totalTime = Math.floor((Date.now() - startTime) / 1000);

            // Determine level based on score
            let determinedLevel, levelName, levelColor;
            if (percentage >= 95) {
                determinedLevel = 'C2';
                levelName = 'Proficient';
                levelColor = '#dc2626';
            } else if (percentage >= 85) {
                determinedLevel = 'C1';
                levelName = 'Advanced';
                levelColor = '#ef4444';
            } else if (percentage >= 70) {
                determinedLevel = 'B2';
                levelName = 'Upper Intermediate';
                levelColor = '#f97316';
            } else if (percentage >= 55) {
                determinedLevel = 'B1';
                levelName = 'Intermediate';
                levelColor = '#f59e0b';
            } else if (percentage >= 40) {
                determinedLevel = 'A2';
                levelName = 'Elementary';
                levelColor = '#34d399';
            } else {
                determinedLevel = 'A1';
                levelName = 'Beginner';
                levelColor = '#10b981';
            }

            // Display results
            document.getElementById('testScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.remove('hidden');

            document.getElementById('resultLevel').textContent = determinedLevel;
            document.getElementById('resultLevel').style.color = levelColor;
            document.getElementById('resultLevelName').textContent = levelName;
            document.getElementById('scoreDisplay').textContent = `${correctAnswers}/${questions.length}`;
            document.getElementById('percentageDisplay').textContent = percentage + '%';
            document.getElementById('timeDisplay').textContent = formatTime(totalTime);

            // Generate recommendation
            const recommendations = {
                'A1': 'Voc√™ est√° no n√≠vel iniciante! Recomendamos come√ßar com li√ß√µes b√°sicas de vocabul√°rio e estruturas simples.',
                'A2': 'Voc√™ tem conhecimentos elementares! Continue praticando com li√ß√µes sobre situa√ß√µes cotidianas.',
                'B1': 'Voc√™ est√° no n√≠vel intermedi√°rio! Foque em expandir seu vocabul√°rio e praticar conversa√ß√£o.',
                'B2': '√ìtimo n√≠vel intermedi√°rio superior! Continue com temas mais complexos e aperfei√ßoe sua flu√™ncia.',
                'C1': 'Excelente! Voc√™ tem n√≠vel avan√ßado. Pratique com conte√∫do acad√™mico e profissional.',
                'C2': 'Impressionante! Voc√™ domina o ingl√™s. Mantenha a pr√°tica com conte√∫do nativo e especializado.'
            };

            document.getElementById('recommendation').textContent = recommendations[determinedLevel];

            // Suggested themes
            const lessonManager = new LessonManager();
            const themes = lessonManager.getThemes();
            document.getElementById('suggestedThemes').innerHTML = `
                <p style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">Temas Recomendados:</p>
                ${themes.map(theme => `
                    <span class="level-badge" style="background: ${theme.color}; color: white;">
                        ${theme.icon} ${theme.name}
                    </span>
                `).join('')}
            `;

            // Store result
            window.placementTestResult = {
                level: determinedLevel,
                score: correctAnswers,
                total: questions.length,
                percentage: percentage,
                time: totalTime
            };

            createConfetti(50);
            SoundFX.play('achievement');
        }

        // Save and continue
        function saveAndContinue() {
            if (window.placementTestResult) {
                // Set user's starting level
                UserProgress.setCurrentLesson('daily-routines', window.placementTestResult.level);

                // Save test result
                const testResults = Storage.load('placementTestResults', []);
                testResults.push({
                    ...window.placementTestResult,
                    date: new Date().toISOString()
                });
                Storage.save('placementTestResults', testResults);

                SoundFX.play('success');
                alert(`√ìtimo! Seu n√≠vel ${window.placementTestResult.level} foi salvo. Voc√™ ser√° direcionado para a p√°gina principal.`);
                window.location.href = 'index.html';
            }
        }

        // Retake test
        function retakeTest() {
            document.getElementById('resultScreen').classList.add('hidden');
            document.getElementById('welcomeScreen').classList.remove('hidden');
            SoundFX.play('click');
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            const currentTheme = ThemeManager.getCurrent();
            document.querySelector('.theme-toggle-slider').textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        });
    </script>
</body>

</html>